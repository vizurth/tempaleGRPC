# gRPC Order Service

## Описание
Этот проект представляет собой **gRPC-сервис** для управления заказами. Сервис предоставляет API для выполнения базовых операций с заказами, таких как **создание, получение, обновление, удаление** и **просмотр всех заказов**.

Сервис хранит заказы в памяти с использованием `map`, обеспечивая безопасный доступ через `sync.Mutex`. Каждый заказ содержит **уникальный идентификатор (ID), название товара (Item) и количество (Quantity)**.

---

## Функциональность
### Методы gRPC-сервиса:
- **CreateOrder** – создаёт новый заказ и возвращает его `ID`.
- **GetOrder** – получает информацию о заказе по `ID`.
- **UpdateOrder** – обновляет данные заказа по `ID`.
- **DeleteOrder** – удаляет заказ по `ID`.
- **ListOrders** – возвращает список всех заказов.

### Структура заказа:
| Поле     | Тип      | Описание                          |
|----------|---------|----------------------------------|
| `ID`     | string  | Уникальный идентификатор заказа |
| `Item`   | string  | Название товара                 |
| `Quantity` | int32 | Количество товара               |

---

## Установка и запуск

### 1. Клонирование репозитория
```sh
git clone <URL_РЕПОЗИТОРИЯ>
cd <ИМЯ_ПРОЕКТА>
```

### 2. Установка зависимостей
```sh
go mod tidy
```

### 3. Генерация gRPC-кода из `.proto`-файла
Файл `.proto` уже сгенерирован и находится в папке `3_1`. Если требуется генерация заново, выполните:
```sh
protoc --go_out=. --go-grpc_out=. pkg/api/test/api/order.proto
```

### 4. Запуск сервера
```sh
go run cmd/server/main.go
```

Сервер будет запущен на `localhost:50051`.

---

## Реализация

### 1. **Система хранения данных**
Заказы хранятся в `map[string]Order`, а доступ к данным синхронизируется с помощью `sync.Mutex` для безопасного многопоточного доступа.

### 2. **Обработка ошибок**
- При попытке получить, обновить или удалить несуществующий заказ сервер вернёт **ошибку**.
- Логирование запросов и ошибок ведётся через `zap.Logger`.
- Используется **gRPC UnaryInterceptor** для автоматического добавления логгера в контекст каждого запроса.

---

## API (Примеры запросов)

### **Создание заказа (CreateOrder)**
Пример запроса:
```sh
grpcurl -plaintext -d '{"item": "Laptop", "quantity": 2}' localhost:50051 test.OrderService/CreateOrder
```
Пример ответа:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### **Получение заказа (GetOrder)**
```sh
grpcurl -plaintext -d '{"id": "550e8400-e29b-41d4-a716-446655440000"}' localhost:50051 test.OrderService/GetOrder
```

### **Обновление заказа (UpdateOrder)**
```sh
grpcurl -plaintext -d '{"id": "550e8400-e29b-41d4-a716-446655440000", "item": "Tablet", "quantity": 5}' localhost:50051 test.OrderService/UpdateOrder
```

### **Удаление заказа (DeleteOrder)**
```sh
grpcurl -plaintext -d '{"id": "550e8400-e29b-41d4-a716-446655440000"}' localhost:50051 test.OrderService/DeleteOrder
```

### **Получение списка всех заказов (ListOrders)**
```sh
grpcurl -plaintext localhost:50051 test.OrderService/ListOrders
```

---

## Дополнительно
- Сервер использует **gRPC UnaryInterceptor** для логирования всех запросов.
- Файл `.proto` **не редактируется**.
- Сервер можно запустить в **Docker** (при необходимости добавить `Dockerfile`).

